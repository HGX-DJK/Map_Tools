var ToolSet=function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=Array(e);n<e;n++)a[n]=t[n];return a}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,i(a.key),a)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,n){return(e=i(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(e,n){return function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var a,r,i,o,c=[],s=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e);else for(;!(s=(a=i.call(n)).done)&&(c.push(a.value),c.length!==e);s=!0);}catch(t){l=!0,r=t}finally{try{if(!s&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw r}}return c}}(e,n)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e);if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}var c=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(t);e&&(i.className=e);for(var o=0,c=Object.entries(n);o<c.length;o++){var s=r(c[o],2),l=s[0],u=s[1];l.startsWith("data-")?i.setAttribute(l,u):l.startsWith("on")?i.addEventListener(l.substring(2).toLowerCase(),u):l.startsWith("mouse")?i.addEventListener(l.toLowerCase(),u):i[l]=u}return a&&(i.innerHTML=a),i},s=function(){return n((function t(n){e(this,t),this.init(n)}),[{key:"init",value:function(t){this.map=t.map,this.position=t.position,this.timer=null,this.isPressing=!1,this.initCompassDom()}},{key:"initCompassDom",value:function(){var t=c("div","compass-opt");this.setPosition(t,this.position),t.appendChild(this.createCompassContainer()),document.body.appendChild(t)}},{key:"setPosition",value:function(t,e){if(t){t.style.position="absolute";var n={top:"10px",left:"10px"};if("string"==typeof e)switch(e){case"top-left":t.style.top="10px",t.style.left="10px";break;case"top-right":t.style.top="10px",t.style.right="10px";break;case"bottom-left":t.style.bottom="10px",t.style.left="10px";break;case"bottom-right":t.style.bottom="10px",t.style.right="10px";break;case"center":t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)";break;default:console.warn("Unsupported position string: ".concat(e,", using default.")),Object.entries(n).forEach((function(e){var n=r(e,2),a=n[0],i=n[1];t.style[a]=i}))}else if("object"===o(e)){var a=e.top,i=e.right,c=e.bottom,s=e.left;void 0!==a&&(t.style.top=a),void 0!==i&&(t.style.right=i),void 0!==c&&(t.style.bottom=c),void 0!==s&&(t.style.left=s),a||i||c||s||Object.entries(n).forEach((function(e){var n=r(e,2),a=n[0],i=n[1];t.style[a]=i}))}else console.warn("Invalid position type, using default."),Object.entries(n).forEach((function(e){var n=r(e,2),a=n[0],i=n[1];t.style[a]=i}))}}},{key:"createCompassContainer",value:function(){var t=this,e=c("div","luopan"),n=c("div","compass",{"data-type":"pointers",style:"transform: rotateX(0deg) rotateZ(0deg);"}),a=c("div","pointers",{"data-type":"pointers",onclick:function(){return t.resetMap()}});return n.appendChild(a),[n,c("div","pitch pitchUp",{"data-type":"pitchUp",onclick:function(){return t.viewPoint("pitch",!0)},onmousedown:function(){return t.longPress("pitch",!0)},onmouseup:function(){return t.clearLongPress()},onmouseleave:function(){return t.clearLongPress()}}),c("div","pitch pitchDown",{"data-type":"pitchDown",onclick:function(){return t.viewPoint("pitch",!1)},onmousedown:function(){return t.longPress("pitch",!1)},onmouseup:function(){return t.clearLongPress()},onmouseleave:function(){return t.clearLongPress()}}),c("div","rotate rotateLeft",{"data-type":"rotateLeft",onclick:function(){return t.viewPoint("bearing",!0)},onmousedown:function(){return t.longPress("bearing",!0)},onmouseup:function(){return t.clearLongPress()},onmouseleave:function(){return t.clearLongPress()}}),c("div","rotate rotateRight",{"data-type":"rotateRight",onclick:function(){return t.viewPoint("bearing",!1)},onmousedown:function(){return t.longPress("bearing",!1)},onmouseup:function(){return t.clearLongPress()},onmouseleave:function(){return t.clearLongPress()}})].forEach((function(t){t&&e.appendChild(t)})),e}},{key:"resetMap",value:function(){var t=document.querySelector(".compass");this.map.setPitch(0),this.map.setBearing(0),t.style.transform="rotateX(0deg) rotateZ(0deg)"}},{key:"viewPoint",value:function(t,e){var n=this,a=this.map.getView(),r=document.querySelector(".compass");({pitch:function(){var t=n.map.getBearing(),i=a.pitch;e?i+=5:i-=5,n.map.setPitch(i),r.style.transform=e?"rotateX(".concat(i,"deg) rotateZ(").concat(t,"deg)"):"rotateX(".concat(i,"deg)  rotateZ(").concat(t,"deg)")},bearing:function(){var t=n.map.getPitch(),i=a.bearing;e?i+=1:i-=1,n.map.setBearing(i),r.style.transform="rotateX(".concat(t,"deg) rotateZ(").concat(-i,"deg)")}})[t]()}},{key:"longPress",value:function(t,e){var n=this;this.isPressing=!0,this.timer||(this.timer=setInterval((function(){n.viewPoint(t,e)}),50))}},{key:"clearLongPress",value:function(){this.timer&&clearInterval(this.timer),this.timer=null,this.isPressing=!1}}])}(),l=function(){return n((function t(n){var r=this;e(this,t),a(this,"partAreaClick",(function(){r.ctx_rect||r.createCanvas(),r.clickType="part",r.ctx_rect.clearRect(0,0,r.canvas_rect.width,r.canvas_rect.height),r.flag=!0,r.drawRectOptput()})),a(this,"allAreaClick",(function(){r.ctx_rect||r.createCanvas(),r.clickType="all",r.ctx_rect.clearRect(0,0,r.canvas_rect.width,r.canvas_rect.height),r.printByScreen((function(t){r.save?r.link(t):r.callback&&r.callback("fullScreenPrint",t)}))})),this.initState(n)}),[{key:"initState",value:function(t){this.callback=t.callback||null,this.printArea=t.printArea||null,this.initImgParams(t),this.clickType="part",this.showUI&&this.initDom(t),this.devicePixelRatio=window.devicePixelRatio||1}},{key:"initImgParams",value:function(t){var e=this;if("object"===o(t.loadBaseMap)&&Object.keys(t.loadBaseMap).length>0){if(this.save=t.loadBaseMap.save,"img"==t.loadBaseMap.type)this.img=t.loadBaseMap.baseMap,this.loadImg();else if("map"==t.loadBaseMap.type)if(t.loadBaseMap.baseMap)try{var n=t.loadBaseMap.baseMap;setTimeout((function(){e.img=e.captureMapImage(n)}),200)}catch(t){console.log(t)}else alert("请将baseMap变量传入");else console.log("暂不支持别的类型");if(this.printArea&&"string"==typeof this.printArea){var a=this.printArea.split(",");4==a.length&&this.printByArea(Number(a[0]),Number(a[1]),Number(a[2]),Number(a[3]),(function(t){e.save?e.link(t):e.callback("autoPrint",t)}))}}this.showUI=t.showUI||!1}},{key:"destory",value:function(){this.removeWholeCanvas();var t=document.querySelector(".sl-wrapper");t&&t.remove()}},{key:"subscribe",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.removeWholeCanvas(),n&&(setTimeout((function(){e.img=e.captureMapImage(t)}),200),this.createCanvas(),this.drawRectOptput())}},{key:"removeWholeCanvas",value:function(){this.canvas_rect&&(document.body.removeChild(this.canvas_rect),this.canvas_rect=null,this.ctx_rect=null)}},{key:"captureMapImage",value:function(t){return t.toDataURL({mimeType:"image/jpeg",save:!1,fileName:"map"})}},{key:"loadImg",value:function(){var t=c("canvas","sl-canvas-img");t.id="sl-canvas-img";var e=document.documentElement.clientWidth,n=document.documentElement.clientHeight;t.width=e,t.height=n,document.body.appendChild(t);var a=t.getContext("2d"),r=new Image;r.src=this.img,r.onload=function(){a.drawImage(r,0,0,r.width,r.height)},this.canvas_img=t,this.ctx_img=a}},{key:"initDom",value:function(t){var e=this,n=c("div","sl-wrapper");document.body.appendChild(n);var a=c("div","sl-container");n.appendChild(a);var r=document.createElement("style");r.textContent="\n            .sl-draw-btn.hover {\n                background: #4a8af4; \n                color:#fff;\n            }\n        ",document.head.appendChild(r);var i=c("div","sl-draw-btn",{onclick:function(){return e.partAreaClick()},mouseover:function(){return i.classList.add("hover")},mouseout:function(){return i.classList.remove("hover")}},"绘制打印");a.appendChild(i);var o=c("div","sl-draw-btn",{onclick:function(){return e.allAreaClick()},mouseover:function(){return o.classList.add("hover")},mouseout:function(){return o.classList.remove("hover")}},"整屏打印");a.appendChild(o)}},{key:"createCanvas",value:function(){this.canvas_rect=c("canvas","sl-canvas-rect"),this.canvas_rect.width=document.documentElement.clientWidth,this.canvas_rect.height=document.documentElement.clientHeight,document.body.appendChild(this.canvas_rect),this.ctx_rect=this.canvas_rect.getContext("2d")}},{key:"drawRectOptput",value:function(){var t=this;"all"!=this.clickType&&this.drawRect((function(e,n,a,r){t.printByArea(e,n,a,r,(function(e){t.save?t.link(e):t.callback&&t.callback("manualPrint",e)}))}))}},{key:"drawRect",value:function(t){var e,n,a,r,i=this,o=0;this.canvas_rect.addEventListener("click",(function(c){if(1===++o)e=c.offsetX,n=c.offsetY,i.flag=!0;else if(2===o){a=c.offsetX,r=c.offsetY;var s=Math.abs(a-e),l=Math.abs(r-n);i.ctx_rect.clearRect(0,0,i.canvas_rect.width,i.canvas_rect.height);var u=e>a?a:e,h=n>r?r:n;i.ctx_rect.strokeStyle="green",i.ctx_rect.strokeRect(u,h,s,l),o=0,i.flag=!1,t(s,l,u,h)}})),this.canvas_rect.addEventListener("mousemove",(function(t){if(i.flag){i.ctx_rect.clearRect(0,0,i.canvas_rect.width,i.canvas_rect.height);var a=t.offsetX,r=t.offsetY,o=a-e,c=r-n;i.ctx_rect.strokeStyle="blue",i.ctx_rect.strokeRect(e,n,o,c)}})),this.canvas_rect.addEventListener("contextmenu",(function(t){t.preventDefault(),i.flag=!1,o=0,i.ctx_rect.clearRect(0,0,i.canvas_rect.width,i.canvas_rect.height)}))}},{key:"createTempCanvas",value:function(t,e,n,a){var r=new Image;r.src=this.img;var i=c(n,a),o=i.getContext("2d");return i.width=t,i.height=e,{image:r,canvas:i,ctx:o}}},{key:"printByArea",value:function(t,e,n,a,r){var i=this.createTempCanvas(t,e,"canvas",""),o=i.image,c=i.canvas,s=i.ctx;this.printByScreen((function(i){o.src=i,o.onload=function(){s.drawImage(o,n,a,t,e,0,0,c.width,c.height);var i=c.toDataURL("image/png");r&&r(i)}}))}},{key:"link",value:function(t){var e=c("a");e.download="screenshot.png",e.href=t,e.click()}},{key:"printByScreen",value:function(t){var e=document.documentElement.clientWidth,n=document.documentElement.clientHeight,a=this.createTempCanvas(e,n,"canvas","sl-canvas"),r=a.image,i=a.canvas,o=a.ctx;r.onload=function(){o.drawImage(r,0,0,r.width,r.height,0,0,i.width,i.height);var e=i.toDataURL();t(e)}}}])}();return{Compass_UI:s,MapPrint:l}}();
